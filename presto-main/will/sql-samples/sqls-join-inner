PartitionedLookupSource
LocalExchange

set session optimize_hash_generation=false;


explain analyze
select o.clerk, o.orderkey, l.linenumber, l.quantity 
from orders o inner join lineitem l on o.orderkey = l.orderkey and o.orderkey < 5 
order by o.orderkey, l.linenumber;


                                                                                                                                                                Query Plan                                                                                   >
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------->
 Fragment 1 [ROUND_ROBIN]                                                                                                                                                                                                                                    >
     CPU: 2.87ms, Scheduled: 3.87ms, Input: 14 rows (602B); per task: avg.: 14.00 std.dev.: 0.00, Output: 14 rows (602B), 1 tasks                                                                                                                            >
     Output layout: [linenumber, quantity, orderkey, clerk]                                                                                                                                                                                                  >
     Output partitioning: SINGLE []                                                                                                                                                                                                                          >
     Stage Execution Strategy: UNGROUPED_EXECUTION                                                                                                                                                                                                           >
     - LocalMerge[PlanNodeId 581][orderkey ASC_NULLS_LAST, linenumber ASC_NULLS_LAST] => [linenumber:integer, quantity:double, orderkey:bigint, clerk:varchar(15)]                                                                                           >
             Estimates: {source: CostBasedSourceInfo, rows: 4 (172B), cpu: 3,638,938.27, memory: 210.51, network: 172.50}                                                                                                                                    >
             CPU: 1.00ms (0.47%), Scheduled: 1.00ms (0.37%), Output: 14 rows (602B)                                                                                                                                                                          >
             Input avg.: 3.50 rows, Input std.dev.: 173.21%                                                                                                                                                                                                  >
         - PartialSort[PlanNodeId 531][orderkey ASC_NULLS_LAST, linenumber ASC_NULLS_LAST] => [linenumber:integer, quantity:double, orderkey:bigint, clerk:varchar(15)]                                                                                      >
                 Estimates: {source: CostBasedSourceInfo, rows: 4 (172B), cpu: 3,638,938.27, memory: 210.51, network: 172.50}                                                                                                                                >
                 CPU: 1.00ms (0.47%), Scheduled: 2.00ms (0.74%), Output: 14 rows (602B)                                                                                                                                                                      >
                 Input avg.: 3.50 rows, Input std.dev.: 173.21%                                                                                                                                                                                              >
             - RemoteSource[2] => [linenumber:integer, quantity:double, orderkey:bigint, clerk:varchar(15)]                                                                                                                                                  >
                     CPU: 0.00ns (0.00%), Scheduled: 0.00ns (0.00%), Output: 14 rows (602B)                                                                                                                                                                  >
                     Input avg.: 3.50 rows, Input std.dev.: 173.21%                                                                                                                                                                                          >
                                                                                                                                                                                                                                                             >
 /* 下面采用的是colocated join方式, 因为表orders和表lineitem采用了相同的partitioning方式 */
 Fragment 2 [tpch:orders:15000]                                                                                                                                                                                                                              >
     CPU: 218.68ms, Scheduled: 277.33ms, Input: 75,175 rows (0B); per task: avg.: 75,175.00 std.dev.: 0.00, Output: 14 rows (602B), 1 tasks                                                                                                                  >
     Output layout: [linenumber, quantity, orderkey, clerk]                                                                                                                                                                                                  >
     Output partitioning: ROUND_ROBIN []                                                                                                                                                                                                                     >
     Stage Execution Strategy: DYNAMIC_LIFESPAN_SCHEDULE_GROUPED_EXECUTION                                                                                                                                                                                   >
     - InnerJoin[PlanNodeId 480][("orderkey_0" = "orderkey")][$hashvalue, $hashvalue_18] => [linenumber:integer, quantity:double, orderkey:bigint, clerk:varchar(15)]                                                                                        >
             Estimates: {source: CostBasedSourceInfo, rows: 4 (172B), cpu: 3,638,593.26, memory: 38.00, network: 0.00}                                                                                                                                       >
             CPU: 11.00ms (5.12%), Scheduled: 15.00ms (5.56%), Output: 14 rows (602B)                                                                                                                                                                        >
             Left (probe) Input avg.: 1.75 rows, Input std.dev.: 264.58%                                                                                                                                                                                     >
             Right (build) Input avg.: 0.13 rows, Input std.dev.: 331.66%                                                                                                                                                                                    >
             Distribution: PARTITIONED                                                                                                                                                                                                                       >
         - ScanFilterProject[PlanNodeId 1,527,626][table = TableHandle {connectorId='tpch', connectorHandle='lineitem:sf0.01', layout='Optional[lineitem:sf0.01]'}, grouped = true, filterPredicate = (orderkey_0) < (BIGINT'5'), projectLocality = LOCAL] =>>
                 Estimates: {source: CostBasedSourceInfo, rows: 60,175 (4.48MB), cpu: 1,384,025.00, memory: 0.00, network: 0.00}/{source: CostBasedSourceInfo, rows: 4 (312B), cpu: 2,768,050.00, memory: 0.00, network: 0.00}/{source: CostBasedSourceInfo, >
                 CPU: 33.00ms (15.35%), Scheduled: 34.00ms (12.59%), Output: 14 rows (448B)                                                                                                                                                                  >
                 Input avg.: 7,521.88 rows, Input std.dev.: 0.52%                                                                                                                                                                                            >
                 $hashvalue := combine_hash(BIGINT'0', COALESCE($operator$hash_code(orderkey_0), BIGINT'0')) (3:53)                                                                                                                                          >
                 orderkey_0 := tpch:orderkey (3:26)                                                                                                                                                                                                          >
                 linenumber := tpch:linenumber (3:26)                                                                                                                                                                                                        >
                 quantity := tpch:quantity (3:26)                                                                                                                                                                                                            >
                 Input: 60,175 rows (0B), Filtered: 99.98%                                                                                                                                                                                                   >
         - LocalExchange[PlanNodeId 580][HASH][$hashvalue_18] (orderkey) => [orderkey:bigint, clerk:varchar(15), $hashvalue_18:bigint]                                                                                                                       >
                 Estimates: {source: CostBasedSourceInfo, rows: 1 (43B), cpu: 870,076.00, memory: 0.00, network: 0.00}                                                                                                                                       >
                 CPU: 2.00ms (0.93%), Scheduled: 2.00ms (0.74%), Output: 4 rows (152B)                                                                                                                                                                       >
                 Input avg.: 0.50 rows, Input std.dev.: 264.58%                                                                                                                                                                                              >
             - ScanFilterProject[PlanNodeId 0,528,627][table = TableHandle {connectorId='tpch', connectorHandle='orders:sf0.01', layout='Optional[orders:sf0.01]'}, grouped = true, filterPredicate = (orderkey) < (BIGINT'5'), projectLocality = LOCAL] => [>
                     Estimates: {source: CostBasedSourceInfo, rows: 15,000 (629.88kB), cpu: 435,000.00, memory: 0.00, network: 0.00}/{source: CostBasedSourceInfo, rows: 1 (43B), cpu: 870,000.00, memory: 0.00, network: 0.00}/{source: CostBasedSourceInfo,>
                     CPU: 167.00ms (77.67%), Scheduled: 216.00ms (80.00%), Output: 4 rows (152B)                                                                                                                                                             >
                     Input avg.: 1,875.00 rows, Input std.dev.: 0.00%                                                                                                                                                                                        >
                     $hashvalue_19 := combine_hash(BIGINT'0', COALESCE($operator$hash_code(orderkey), BIGINT'0')) (3:6)                                                                                                                                      >
                     orderkey := tpch:orderkey (3:6)                                                                                                                                                                                                         >
                     clerk := tpch:clerk (3:6)                                                                                                                                                                                                               >
                     tpch:orderstatus                                                                                                                                                                                                                        >
                         :: [["F"], ["O"], ["P"]]                                                                                                                                                                                                            >
                     Input: 15,000 rows (0B), Filtered: 99.97%                                                                                                                                                                                               >
                                                                                                                                                                                                                                                             >
                                                                                                                                                                                                                                                             >
(1 row)
select sum(price * (1-discount)*(1+tax)) as totalOrderPrice from lineitem where orderkey = 1;

SET SESSION join_distribution_type = 'BROADCAST';

explain (type distributed)
select o.orderkey as orderName, count(item.linenumber) as items, sum(item.quantity) as quantities
from orders as o, lineitem as item
where o.orderkey = item.orderkey
group by o.orderkey 
order by items desc 
limit 10;


Logical Plan
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 - Output[orderName, items, quantities] => [orderkey:bigint, count:bigint, sum:double]                                                                                                                                                                                   
         orderName := orderkey (1:16)                                                                                                                                                                                                                                    
         items := count (1:41)                                                                                                                                                                                                                                           
         quantities := sum (1:74)                                                                                                                                                                                                                                        
     - TopN[10 by (count DESC_NULLS_LAST)] => [orderkey:bigint, count:bigint, sum:double]                                                                                                                                                                                
         - LocalExchange[SINGLE] () => [orderkey:bigint, count:bigint, sum:double]                                                                                                                                                                                       
             - RemoteStreamingExchange[GATHER] => [orderkey:bigint, count:bigint, sum:double]                                                                                                                                                                            
                 - TopNPartial[10 by (count DESC_NULLS_LAST)] => [orderkey:bigint, sum:double, count:bigint]                                                                                                                                                             
                     - Aggregate(FINAL)[orderkey] => [orderkey:bigint, sum:double, count:bigint]                                                                                                                                                                         
                             sum := "presto.default.sum"((sum_15)) (1:74)                                                                                                                                                                                                
                             count := "presto.default.count"((count_14)) (1:41)                                                                                                                                                                                          
                         - LocalExchange[HASH][$hashvalue] (orderkey) => [orderkey:bigint, sum_15:double, count_14:bigint, $hashvalue:bigint]                                                                                                                            
                             - RemoteStreamingExchange[REPARTITION][$hashvalue_16] => [orderkey:bigint, sum_15:double, count_14:bigint, $hashvalue_16:bigint]                                                                                                            
                                 - Project[projectLocality = LOCAL] => [orderkey:bigint, sum_15:double, count_14:bigint, $hashvalue_21:bigint]                                                                                                                           
                                         $hashvalue_21 := combine_hash(BIGINT'0', COALESCE($operator$hash_code(orderkey), BIGINT'0')) (4:10)                                                                                                                             
                                     - Aggregate(PARTIAL)[orderkey] => [orderkey:bigint, sum_15:double, count_14:bigint]                                                                                                                                                 
                                             sum_15 := "presto.default.sum"((quantity)) (1:74)                                                                                                                                                                           
                                             count_14 := "presto.default.count"((linenumber)) (1:41)                                                                                                                                                                     
                                         - InnerJoin[("orderkey" = "orderkey_0")][$hashvalue_17, $hashvalue_18] => [orderkey:bigint, linenumber:bigint, quantity:double]                                                                                                 
                                                 Distribution: REPLICATED                                                                                                                                                                                                
                                             - ScanProject[table = TableHandle {connectorId='example', connectorHandle='example:tpch:orders', layout='Optional[example:tpch:orders]'}, projectLocality = LOCAL] => [orderkey:bigint, $hashvalue_17:bigint]               
                                                     Estimates: {rows: ? (?), cpu: ?, memory: 0.00, network: 0.00}/{rows: ? (?), cpu: ?, memory: 0.00, network: 0.00}                                                                                                    
                                                     $hashvalue_17 := combine_hash(BIGINT'0', COALESCE($operator$hash_code(orderkey), BIGINT'0')) (2:7)                                                                                                                  
                                                     orderkey := ExampleColumnHandle{connectorId=example, columnName=orderkey, columnType=bigint, ordinalPosition=0} (2:6)                                                                                               
                                             - LocalExchange[HASH][$hashvalue_18] (orderkey_0) => [orderkey_0:bigint, linenumber:bigint, quantity:double, $hashvalue_18:bigint]                                                                                          
                                                     Estimates: {rows: ? (?), cpu: ?, memory: 0.00, network: ?}                                                                                                                                                          
                                                 - RemoteStreamingExchange[REPLICATE] => [orderkey_0:bigint, linenumber:bigint, quantity:double, $hashvalue_19:bigint]                                                                                                   
                                                         Estimates: {rows: ? (?), cpu: ?, memory: 0.00, network: ?}                                                                                                                                                      
                                                     - ScanProject[table = TableHandle {connectorId='example', connectorHandle='example:tpch:lineitem', layout='Optional[example:tpch:lineitem]'}, projectLocality = LOCAL] => [orderkey_0:bigint, linenumber:bigint, qua
                                                             Estimates: {rows: ? (?), cpu: ?, memory: 0.00, network: 0.00}/{rows: ? (?), cpu: ?, memory: 0.00, network: 0.00}                                                                                            
                                                             $hashvalue_20 := combine_hash(BIGINT'0', COALESCE($operator$hash_code(orderkey_0), BIGINT'0')) (2:19)                                                                                                       
                                                             orderkey_0 := ExampleColumnHandle{connectorId=example, columnName=orderkey, columnType=bigint, ordinalPosition=0} (2:19)                                                                                    
                                                             quantity := ExampleColumnHandle{connectorId=example, columnName=quantity, columnType=double, ordinalPosition=4} (2:19)                                                                                      
                                                             linenumber := ExampleColumnHandle{connectorId=example, columnName=linenumber, columnType=bigint, ordinalPosition=3} (2:19)                                                                                  
                                                                                                                                                                                                                                                                         
(1 row)



Distributed Plan
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Fragment 0 [SINGLE]                                                                                                                                                                                                                                                     
     Output layout: [orderkey, count, sum]                                                                                                                                                                                                                               
     Output partitioning: SINGLE []                                                                                                                                                                                                                                      
     Stage Execution Strategy: UNGROUPED_EXECUTION                                                                                                                                                                                                                       
     - Output[orderName, items, quantities] => [orderkey:bigint, count:bigint, sum:double]                                                                                                                                                                               
             orderName := orderkey (2:8)                                                                                                                                                                                                                                 
             items := count (2:33)                                                                                                                                                                                                                                       
             quantities := sum (2:66)                                                                                                                                                                                                                                    
         - TopN[10 by (count DESC_NULLS_LAST)] => [orderkey:bigint, count:bigint, sum:double]                                                                                                                                                                            
             - LocalExchange[SINGLE] () => [orderkey:bigint, count:bigint, sum:double]                                                                                                                                                                                   
                 - RemoteSource[1] => [orderkey:bigint, count:bigint, sum:double]                                                                                                                                                                                        
                                                                                                                                                                                                                                                                         
 Fragment 1 [HASH]                                                                                                                                                                                                                                                       
     Output layout: [orderkey, count, sum]                                                                                                                                                                                                                               
     Output partitioning: SINGLE []                                                                                                                                                                                                                                      
     Stage Execution Strategy: UNGROUPED_EXECUTION                                                                                                                                                                                                                       
     - TopNPartial[10 by (count DESC_NULLS_LAST)] => [orderkey:bigint, sum:double, count:bigint]                                                                                                                                                                         
         - Aggregate(FINAL)[orderkey] => [orderkey:bigint, sum:double, count:bigint]                                                                                                                                                                                     
                 sum := "presto.default.sum"((sum_15)) (2:66)                                                                                                                                                                                                            
                 count := "presto.default.count"((count_14)) (2:33)                                                                                                                                                                                                      
             - LocalExchange[HASH][$hashvalue] (orderkey) => [orderkey:bigint, sum_15:double, count_14:bigint, $hashvalue:bigint]                                                                                                                                        
                 - RemoteSource[2] => [orderkey:bigint, sum_15:double, count_14:bigint, $hashvalue_16:bigint]                                                                                                                                                            
                                                                                                                                                                                                                                                                         
 Fragment 2 [SOURCE]                                                                                                                                                                                                                                                     
     Output layout: [orderkey, sum_15, count_14, $hashvalue_21]                                                                                                                                                                                                          
     Output partitioning: HASH [orderkey][$hashvalue_21]                                                                                                                                                                                                                 
     Stage Execution Strategy: UNGROUPED_EXECUTION                                                                                                                                                                                                                       
     - Project[projectLocality = LOCAL] => [orderkey:bigint, sum_15:double, count_14:bigint, $hashvalue_21:bigint]                                                                                                                                                       
             $hashvalue_21 := combine_hash(BIGINT'0', COALESCE($operator$hash_code(orderkey), BIGINT'0')) (5:10)                                                                                                                                                         
         - Aggregate(PARTIAL)[orderkey] => [orderkey:bigint, sum_15:double, count_14:bigint]                                                                                                                                                                             
                 sum_15 := "presto.default.sum"((quantity)) (2:66)                                                                                                                                                                                                       
                 count_14 := "presto.default.count"((linenumber)) (2:33)                                                                                                                                                                                                 
             - InnerJoin[("orderkey" = "orderkey_0")][$hashvalue_17, $hashvalue_18] => [orderkey:bigint, linenumber:bigint, quantity:double]                                                                                                                             
                     Distribution: REPLICATED                                                                                                                                                                                                                            
                 - ScanProject[table = TableHandle {connectorId='example', connectorHandle='example:tpch:orders', layout='Optional[example:tpch:orders]'}, grouped = false, projectLocality = LOCAL] => [orderkey:bigint, $hashvalue_17:bigint]                          
                         Estimates: {rows: ? (?), cpu: ?, memory: 0.00, network: 0.00}/{rows: ? (?), cpu: ?, memory: 0.00, network: 0.00}                                                                                                                                
                         $hashvalue_17 := combine_hash(BIGINT'0', COALESCE($operator$hash_code(orderkey), BIGINT'0')) (3:7)                                                                                                                                              
                         orderkey := ExampleColumnHandle{connectorId=example, columnName=orderkey, columnType=bigint, ordinalPosition=0} (3:6)                                                                                                                           
                 - LocalExchange[HASH][$hashvalue_18] (orderkey_0) => [orderkey_0:bigint, linenumber:bigint, quantity:double, $hashvalue_18:bigint]                                                                                                                      
                         Estimates: {rows: ? (?), cpu: ?, memory: 0.00, network: ?}                                                                                                                                                                                      
                     - RemoteSource[3] => [orderkey_0:bigint, linenumber:bigint, quantity:double, $hashvalue_19:bigint]                                                                                                                                                  
                                                                                                                                                                                                                                                                         
 Fragment 3 [SOURCE]                                                                                                                                                                                                                                                     
     Output layout: [orderkey_0, linenumber, quantity, $hashvalue_20]                                                                                                                                                                                                    
     Output partitioning: BROADCAST []                                                                                                                                                                                                                                   
     Stage Execution Strategy: UNGROUPED_EXECUTION                                                                                                                                                                                                                       
     - ScanProject[table = TableHandle {connectorId='example', connectorHandle='example:tpch:lineitem', layout='Optional[example:tpch:lineitem]'}, grouped = false, projectLocality = LOCAL] => [orderkey_0:bigint, linenumber:bigint, quantity:double, $hashvalue_20:big
             Estimates: {rows: ? (?), cpu: ?, memory: 0.00, network: 0.00}/{rows: ? (?), cpu: ?, memory: 0.00, network: 0.00}                                                                                                                                            
             $hashvalue_20 := combine_hash(BIGINT'0', COALESCE($operator$hash_code(orderkey_0), BIGINT'0')) (3:19)                                                                                                                                                       
             orderkey_0 := ExampleColumnHandle{connectorId=example, columnName=orderkey, columnType=bigint, ordinalPosition=0} (3:19)                                                                                                                                    
             quantity := ExampleColumnHandle{connectorId=example, columnName=quantity, columnType=double, ordinalPosition=4} (3:19)                                                                                                                                      
             linenumber := ExampleColumnHandle{connectorId=example, columnName=linenumber, columnType=bigint, ordinalPosition=3} (3:19)                                                                                                                                  
                                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                                         
(1 row)

